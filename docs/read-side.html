<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Read Side · reSolve</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The reSolve framework&#x27;s read side listens to events that the write side produces. Based on these events, the read side updates the read models that provide data to the queries."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Read Side · reSolve"/><meta property="og:type" content="website"/><meta property="og:url" content="https://reimagined.github.io/resolve/"/><meta property="og:description" content="The reSolve framework&#x27;s read side listens to events that the write side produces. Based on these events, the read side updates the read models that provide data to the queries."/><meta property="og:image" content="https://reimagined.github.io/resolve/img/reSolve400x400-fill.png"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/resolve/undefined"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-118635726-3', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/resolve/js/scrollSpy.js"></script><link rel="stylesheet" href="/resolve/css/main.css"/><script src="/resolve/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/resolve/"><img class="logo" src="/resolve/img/resolve.svg" alt="reSolve"/><h2 class="headerTitleWithLogo">reSolve</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://medium.com/resolvejs" target="_self">Blog</a></li><li class="siteNavGroupActive"><a href="/resolve/docs/" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/resolve/docs/tutorial" target="_self">Tutorial</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/reimagined/resolve" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Basics</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Docs Index</h3><ul class=""><li class="navListItem"><a class="navItem" href="/resolve/docs/">reSolve Documentation</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/tutorial">Step-by-Step Tutorial</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Basics</h4><ul><li class="navListItem"><a class="navItem" href="/resolve/docs/write-side">Write Side</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/resolve/docs/read-side">Read Side</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/sagas">Sagas</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/api-handlers">API Handlers</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/frontend">Frontend</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/manage-application">Manage a ReSolve Application</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/app-structure">reSolve App Structure</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/resolve/docs/advanced-techniques">Advanced Techniques</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/authentication-and-authorization">Authentication and Authorization</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/preparing-to-production">Preparing to Production</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/testing">Testing</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/api-reference">API Reference</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/application-configuration">Application Configuration</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/contributing">Contributing</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">FAQ</h3><ul class=""><li class="navListItem"><a class="navItem" href="/resolve/docs/faq">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Troubleshooting</h3><ul class=""><li class="navListItem"><a class="navItem" href="/resolve/docs/troubleshooting">Troubleshooting</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Read Side</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="read-models"></a><a href="#read-models" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Read Models</h2>
<p>The reSolve framework's read side listens to events that the write side produces. Based on <strong>these</strong> events, the read side updates the <strong>Read Models</strong>, and these models provide data to the queries.</p>
<p>A Read Model is defined by a set of projection functions and query resolver functions.</p>
<ul>
<li><strong><a href="#updating-a-read-model-via-projection-functions">Projection functions</a></strong> build a Read Models state based on incoming events.</li>
<li><strong><a href="#resolvers">Query resolvers</a></strong> use data from the accumulated state to answer queries.</li>
</ul>
<p>ReSolve also supports <strong>View Models</strong>. A View Model is a Read Model that can be built on the fly, sent to the client and kept there up-to-date. Refer to the <a href="#view-model-specifics">View Model Specifics</a> section for more information.</p>
<h2><a class="anchor" aria-hidden="true" id="configuring-read-models-and-view-models"></a><a href="#configuring-read-models-and-view-models" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring Read Models and View Models</h2>
<h3><a class="anchor" aria-hidden="true" id="configuring-read-models"></a><a href="#configuring-read-models" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring Read Models</h3>
<p>All of the application's Read Models should be registered in the <strong>config.app.js</strong> file's <strong>readModels</strong> section:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> appConfig = {
  ...
  readModels: [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'default'</span>,
      <span class="hljs-attr">projection</span>: <span class="hljs-string">'common/read-models/default.projection.js'</span>,
      <span class="hljs-attr">resolvers</span>: <span class="hljs-string">'common/read-models/default.resolvers.js'</span>,
      <span class="hljs-attr">connectorName</span>: <span class="hljs-string">'default'</span>
    }
  ],
}
</code></pre>
<p>In the configuration object, specify the Read Model's name and the paths to the files containing projections, resolvers, and the Read Model connector's name.</p>
<p>A Read Model connector defines how a Read Model's data should be stored. You can define the available connectors in the <strong>readModelConnectors</strong> section:</p>
<h5><a class="anchor" aria-hidden="true" id="configdevjs"></a><a href="#configdevjs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>config.dev.js:</h5>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> devConfig = {
  ...
  readModelConnectors: {
    <span class="hljs-attr">default</span>: {
      <span class="hljs-attr">module</span>: <span class="hljs-string">'@resolve-js/readmodel-lite'</span>,
      <span class="hljs-attr">options</span>: {}
    }
  },
}
</code></pre>
<h5><a class="anchor" aria-hidden="true" id="configcloudjs"></a><a href="#configcloudjs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>config.cloud.js:</h5>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> { declareRuntimeEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'@resolve-js/scripts'</span>
<span class="hljs-keyword">const</span> prodConfig = {
  ...
  readModelConnectors: {
    <span class="hljs-attr">default</span>: {
      <span class="hljs-attr">module</span>: <span class="hljs-string">'@resolve-js/readmodel-postgresql-serverless'</span>,
      <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">dbClusterOrInstanceArn</span>: declareRuntimeEnv(<span class="hljs-string">'RESOLVE_READMODEL_POSTGRESQL_CLUSTER_ARN'</span>),
        <span class="hljs-attr">awsSecretStoreArn</span>: declareRuntimeEnv(<span class="hljs-string">'RESOLVE_READMODEL_POSTGRESQL_SECRET_ARN'</span>),
        <span class="hljs-attr">databaseName</span>: declareRuntimeEnv(<span class="hljs-string">'RESOLVE_READMODEL_POSTGRESQL_DATABASE_NAME'</span>),
        <span class="hljs-attr">region</span>: declareRuntimeEnv(<span class="hljs-string">'AWS_REGION'</span>)
      }
    }
  },
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="configuring-view-models"></a><a href="#configuring-view-models" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring View Models</h3>
<p>Register your View Models in the <strong>viewModels</strong> configuration section:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> appConfig = {
  ...
  viewModels: [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'storyDetails'</span>,
      <span class="hljs-attr">projection</span>: <span class="hljs-string">'common/view-models/story_details.projection.js'</span>,
      <span class="hljs-attr">serializeState</span>: <span class="hljs-string">'common/view-models/story_details.serialize_state.js'</span>,
      <span class="hljs-attr">deserializeState</span>: <span class="hljs-string">'common/view-models/story_details.deserialize_state.js'</span>,
      <span class="hljs-attr">resolver</span>: <span class="hljs-string">'common/view-models/story-details.validator.js'</span>
    }
  ]
}
</code></pre>
<p>In the configuration object, specify the View Model's name and the path to the file containing projection definition. Use the <strong>serializeState</strong> and <strong>deserializeState</strong> options to specify paths to a View Model's serializer and deserializer functions. Specify the <strong>resolver</strong> option to add a <a href="#view-model-resolver">View Model resolver</a> to the View Model.</p>
<h2><a class="anchor" aria-hidden="true" id="initialize-a-read-model"></a><a href="#initialize-a-read-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initialize a Read Model</h2>
<p>Each Read Model projection object should define an <strong>Init</strong> function that initializes the Read Model storage.</p>
<p>You can use the <strong>defineTable</strong> method to add tables to the storage:</p>
<pre><code class="hljs css language-js">  Init: <span class="hljs-keyword">async</span> store =&gt; {
    ...
    await store.defineTable(<span class="hljs-string">'Comments'</span>, {
      <span class="hljs-attr">indexes</span>: { <span class="hljs-attr">id</span>: <span class="hljs-string">'string'</span> },
      <span class="hljs-attr">fields</span>: [
        <span class="hljs-string">'text'</span>,
        <span class="hljs-string">'parentId'</span>,
        <span class="hljs-string">'comments'</span>,
        <span class="hljs-string">'storyId'</span>,
        <span class="hljs-string">'createdAt'</span>,
        <span class="hljs-string">'createdBy'</span>,
        <span class="hljs-string">'createdByName'</span>
      ]
    })
  }
</code></pre>
<p>ReSolve provides a unified API to manage data in storage (this code works with any supported storage type). <strong>Read Model Adapters</strong> provide the internal logic a Read Model uses to communicate with DBMSs.</p>
<p>We recommend that you store Read Model data in a denormalized form so that your Read Models are optimized for query performance.</p>
<h2><a class="anchor" aria-hidden="true" id="updating-a-read-model-via-projection-functions"></a><a href="#updating-a-read-model-via-projection-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Updating a Read Model via Projection Functions</h2>
<p>A projection function is used to accumulate the event data in a <strong>Read Model storage</strong>. Each projection function receives the storage object and event information. The event information includes the aggregateID, timestamp, and payload.</p>
<p>You can use the <a href="/resolve/docs/api-reference#read-model-store-interface">standard API</a> to communicate with the store. The code sample below demonstrates a Read Model projection function's implementation:</p>
<pre><code class="hljs css language-js">[STORY_COMMENTED]: <span class="hljs-keyword">async</span> (
  store, { aggregateId, timestamp, <span class="hljs-attr">payload</span>: { parentId, userId, userName, commentId, text } }
) =&gt; {
  <span class="hljs-keyword">const</span> comment = { <span class="hljs-attr">id</span>: commentId, text, parentId, <span class="hljs-attr">comments</span>: [], <span class="hljs-attr">storyId</span>: aggregateId,
    <span class="hljs-attr">createdAt</span>: timestamp, <span class="hljs-attr">createdBy</span>: userId, <span class="hljs-attr">createdByName</span>: userName }

  <span class="hljs-keyword">await</span> store.insert(<span class="hljs-string">'Comments'</span>, comment)
  <span class="hljs-keyword">await</span> store.update(
    <span class="hljs-string">'Stories'</span>,
    { <span class="hljs-attr">id</span>: aggregateId },
    { <span class="hljs-attr">$inc</span>: { <span class="hljs-attr">commentCount</span>: <span class="hljs-number">1</span> } }
  )
}
...
</code></pre>
<p>A <a href="#resolvers">resolver</a> then uses the data from the store to prepare final data samples for data requests.</p>
<blockquote>
<p>A Read Model's projection should only use tables that were created in this Read Model's <code>Init</code> handler. If you try to access tables created in other Read Models, a “Table does not exist” error is generated.</p>
</blockquote>
<p>Note that you can add additional logic to a projection function. For instance, you can perform SQL queries, update Elastic Search indexes, write arbitrary data to files, etc.</p>
<p>If you delete the Read Model storage, the framework re-populates the store based on all the events. This can be useful in the development environment and when you deploy an updated version of the application.</p>
<h2><a class="anchor" aria-hidden="true" id="resolvers"></a><a href="#resolvers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Resolvers</h2>
<p>A <strong>resolver</strong> is the part of a Read Model that handles data requests. A resolver function receives the store and request parameters. Based on the parameters, the resolver function pulls data from the store and processes it to prepare the response object.</p>
<p>The code sample below demonstrates a Read Model implementation:</p>
<pre><code class="hljs css language-js">comments: <span class="hljs-keyword">async</span> (store, { first, offset }) =&gt; {
  <span class="hljs-keyword">const</span> skip = first || <span class="hljs-number">0</span>
  <span class="hljs-keyword">const</span> comments = <span class="hljs-keyword">await</span> store.find(
    <span class="hljs-string">'Comments'</span>,
    {},
    <span class="hljs-literal">null</span>,
    { <span class="hljs-attr">createdAt</span>: <span class="hljs-number">-1</span> },
    skip,
    skip + offset
  )
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.isArray(comments) ? comments : []
}
</code></pre>
<p>Refer to the <a href="#query-a-read-model">Query a Read Model</a> section for information on how to send a request to a Read Model resolver.</p>
<h2><a class="anchor" aria-hidden="true" id="view-model-specifics"></a><a href="#view-model-specifics" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>View Model Specifics</h2>
<p><strong>View Models</strong> are ephemeral Read Models that are queried based on aggregate ID. They have the following properties:</p>
<ul>
<li>View Models are rebuilt on every request. They do not store persistent state and do not use the Read Model store.</li>
<li>View Models are queried based on aggregate ID and can maintain a WebSocket connection to push data updates to the client.</li>
<li>View Model projections are defined in a format that is isomorphic with Redux reducers so their code can also be used on the client side to define reducer logic.</li>
</ul>
<p>Use View Models in the following scenarios:</p>
<ul>
<li>To create aggregate-centric views that request relatively small portions of data based on aggregate IDs.</li>
<li>To create reactive components, whose state is kept up-to date on the client.</li>
</ul>
<p>A View Model's projection function receives a state and an event object, and returns an updated state. A projection function runs for every event with the specified aggregate ID from the beginning of the history on every request so it is important to keep View Models small. You can also store snapshots of the View Model state to optimize system resource consumption.</p>
<p>The code sample below demonstrates a View Model projection function:</p>
<!-- prettier-ignore-start -->
<pre><code class="hljs css language-js">  [SHOPPING_ITEM_CREATED]: <span class="hljs-function">(<span class="hljs-params">state, { payload: { id, text } }</span>) =&gt;</span> ({
    ...state,
    <span class="hljs-attr">list</span>: [
      ...state.list,
      {
        id,
        text,
        <span class="hljs-attr">checked</span>: <span class="hljs-literal">false</span>
      }
    ]
  }),
</code></pre>
<!-- prettier-ignore-end -->
<p>Refer to the <a href="#query-a-view-model">Query a View Model</a> section, for information on how to query a View Model.</p>
<h2><a class="anchor" aria-hidden="true" id="view-model-resolver"></a><a href="#view-model-resolver" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>View Model Resolver</h2>
<p>A View Model's <strong>resolver</strong> allows you to restrict a user's access to the View Model's data. A resolver function receives the following parameters:</p>
<ul>
<li>The reSolve context object;</li>
<li>The query object that contains a list of aggregate IDs;</li>
<li>An object that contains a JSON Web Token and View Model settings. The View Model settings object contains the View Model's name and a list of available event types.</li>
</ul>
<p>In the resolver's code, you can use arbitrary logic to check a user's access permissions and either throw an exception to indicate an access error or filter the <code>eventTypes</code> list to specify what events are available to the user.</p>
<p>The resolver function should return a built View Model data object and a meta object that contains the following data:</p>
<ul>
<li>The data cursor used to traverse the events included into the query result set. The initial cursor is returned by the <code>buildViewModel</code> function;</li>
<li>A list of event types available to the client;</li>
<li>A list of aggregate IDs available to the client.</li>
</ul>
<p>The code sample below demonstrates a View Model resolver implementation:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// common/view-models/story-details.validator.js</span>
<span class="hljs-keyword">import</span> jwt <span class="hljs-keyword">from</span> <span class="hljs-string">'jsonwebtoken'</span>
<span class="hljs-keyword">import</span> jwtSecret <span class="hljs-keyword">from</span> <span class="hljs-string">'../../auth/jwt-secret'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> (resolve, query, { <span class="hljs-attr">jwt</span>: token, viewModel }) =&gt; {
  <span class="hljs-keyword">try</span> {
    jwt.verify(token, jwtSecret)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Permission denied'</span>)
  }

  <span class="hljs-keyword">const</span> { data, cursor } = <span class="hljs-keyword">await</span> resolve.buildViewModel(viewModel.name, query)

  <span class="hljs-keyword">return</span> {
    data,
    <span class="hljs-attr">meta</span>: {
      cursor,
      <span class="hljs-attr">eventTypes</span>: viewModel.eventTypes,
      <span class="hljs-attr">aggregateIds</span>: query.aggregateIds,
    },
  }
}
</code></pre>
<p>Use a View Model's <code>resolver</code> configuration option to register a resolver:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// config.app.js</span>
<span class="hljs-keyword">const</span> appConfig = {
  ...
  viewModels: [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'storyDetails'</span>,
      ...
      resolver: <span class="hljs-string">'common/view-models/story-details.validator.js'</span>
    }
  ]
}
</code></pre>
<p>See the <a href="#configuring-view-models">Configuring View Models</a> section for more information.</p>
<h2><a class="anchor" aria-hidden="true" id="performing-queries-using-http-api"></a><a href="#performing-queries-using-http-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Performing Queries Using HTTP API</h2>
<h3><a class="anchor" aria-hidden="true" id="query-a-read-model"></a><a href="#query-a-read-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query a Read Model</h3>
<p>To query a Read Model from the client side, send a POST request to the following URL:</p>
<pre><code class="hljs"><span class="xml">http://</span><span class="hljs-template-variable">{host}</span><span class="xml">:</span><span class="hljs-template-variable">{port}</span><span class="xml">/api/query/</span><span class="hljs-template-variable">{readModel}</span><span class="xml">/</span><span class="hljs-template-variable">{resolver}</span><span class="xml">
</span></code></pre>
<h5><a class="anchor" aria-hidden="true" id="url-parameters"></a><a href="#url-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>URL Parameters:</h5>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><strong>readModel</strong></td><td>The Read Model name as defined in <a href="https://github.com/reimagined/resolve/blob/master/examples/with-saga/config.app.js">config.app.js</a></td></tr>
<tr><td><strong>resolver</strong></td><td>The name of a <a href="#resolvers">resolver defined in the Read Model</a></td></tr>
</tbody>
</table>
<p>The request body should have the <code>application/json</code> content type and the following structure:</p>
<pre><code class="hljs css language-js">{
  <span class="hljs-attr">param1</span>: value1,
  <span class="hljs-attr">param2</span>: value2,
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">paramN</span>: valueN
}
</code></pre>
<p>The object contains the parameters that the resolver accepts.</p>
<h5><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h5>
<p>Use the following command to get 3 users from the <a href="https://github.com/reimagined/resolve/tree/master/examples/with-saga">with-saga</a> example.</p>
<pre><code class="hljs css language-sh">curl -X POST \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-d <span class="hljs-string">"{\"page\":0, \"limit\":3}"</span> \
<span class="hljs-string">"http://localhost:3000/api/query/default/users"</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="query-a-view-model"></a><a href="#query-a-view-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query a View Model</h3>
<p>To query a View Model from the client side, send a GET request to the following URL:</p>
<pre><code class="hljs"><span class="xml">http://</span><span class="hljs-template-variable">{host}</span><span class="xml">:</span><span class="hljs-template-variable">{port}</span><span class="xml">/api/query/</span><span class="hljs-template-variable">{viewModel}</span><span class="xml">/</span><span class="hljs-template-variable">{aggregateIds}</span><span class="xml">
</span></code></pre>
<h5><a class="anchor" aria-hidden="true" id="url-parameters-1"></a><a href="#url-parameters-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>URL Parameters</h5>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>viewModel</td><td>The View Model name as defined in <a href="https://github.com/reimagined/resolve/blob/master/examples/shopping-list/config.app.js">config.app.js</a></td></tr>
<tr><td>aggregateIds</td><td>The comma-separated list of Aggregate IDs to include in the View Model. Use <code>*</code> to include all Aggregates</td></tr>
</tbody>
</table>
<h5><a class="anchor" aria-hidden="true" id="example-1"></a><a href="#example-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h5>
<p>Use the following command to get the current <a href="https://github.com/reimagined/resolve/tree/master/examples/shopping-list">shopping-list</a> example application's state.</p>
<pre><code class="hljs css language-sh">curl -g -X GET <span class="hljs-string">"http://localhost:3000/api/query/Default/shoppingLists"</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/resolve/docs/write-side"><span class="arrow-prev">← </span><span>Write Side</span></a><a class="docs-next button" href="/resolve/docs/sagas"><span>Sagas</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#read-models">Read Models</a></li><li><a href="#configuring-read-models-and-view-models">Configuring Read Models and View Models</a><ul class="toc-headings"><li><a href="#configuring-read-models">Configuring Read Models</a></li><li><a href="#configuring-view-models">Configuring View Models</a></li></ul></li><li><a href="#initialize-a-read-model">Initialize a Read Model</a></li><li><a href="#updating-a-read-model-via-projection-functions">Updating a Read Model via Projection Functions</a></li><li><a href="#resolvers">Resolvers</a></li><li><a href="#view-model-specifics">View Model Specifics</a></li><li><a href="#view-model-resolver">View Model Resolver</a></li><li><a href="#performing-queries-using-http-api">Performing Queries Using HTTP API</a><ul class="toc-headings"><li><a href="#query-a-read-model">Query a Read Model</a></li><li><a href="#query-a-view-model">Query a View Model</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/resolve/" class="nav-home"><img src="/resolve/img/resolve.svg" alt="reSolve" width="66" height="58"/></a><div><h5>Docs</h5><a href="/resolve/docs/">Documentation Index</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/resolvejs" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/resolvejs" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.facebook.com/resolvejs/" target="_blank" rel="noreferrer noopener">Facebook</a></div><div><h5>More</h5><a href="https://github.com/reimagined/resolve">GitHub</a><a class="github-button" href="https://github.com/reimagined/resolve" data-icon="octicon-star" data-count-href="/reimagined/resolve/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2021 Developer Express, Inc</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '2acd75b7a94d568aa418a4f02bd811cc',
                indexName: 'reimagined_resolve',
                inputSelector: '#search_input_react'
              });
            </script></body></html>