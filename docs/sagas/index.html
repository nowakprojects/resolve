<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Sagas · reSolve</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A saga describes a long running process as a sequence of events."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Sagas · reSolve"/><meta property="og:type" content="website"/><meta property="og:url" content="https://reimagined.github.io/resolve/"/><meta property="og:description" content="A saga describes a long running process as a sequence of events."/><meta property="og:image" content="https://reimagined.github.io/resolve/img/reSolve400x400-fill.png"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/resolve/undefined"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-118635726-3', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/resolve/js/scrollSpy.js"></script><link rel="stylesheet" href="/resolve/css/main.css"/><script src="/resolve/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/resolve/"><img class="logo" src="/resolve/img/resolve.svg" alt="reSolve"/><h2 class="headerTitleWithLogo">reSolve</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://medium.com/resolvejs" target="_self">Blog</a></li><li class="siteNavGroupActive"><a href="/resolve/docs/" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/resolve/docs/tutorial" target="_self">Tutorial</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/reimagined/resolve" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Basics</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Docs Index</h3><ul class=""><li class="navListItem"><a class="navItem" href="/resolve/docs/">reSolve Documentation</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/tutorial">Step-by-Step Tutorial</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Basics</h4><ul><li class="navListItem"><a class="navItem" href="/resolve/docs/write-side">Write Side</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/read-side">Read Side</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/resolve/docs/sagas">Sagas</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/api-handlers">API Handlers</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/frontend">Frontend</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/manage-application">Manage a ReSolve Application</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/app-structure">reSolve App Structure</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/resolve/docs/advanced-techniques">Advanced Techniques</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/authentication-and-authorization">Authentication and Authorization</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/preparing-to-production">Preparing to Production</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/testing">Testing</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/api-reference">API Reference</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/application-configuration">Application Configuration</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/contributing">Contributing</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">FAQ</h3><ul class=""><li class="navListItem"><a class="navItem" href="/resolve/docs/faq">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Troubleshooting</h3><ul class=""><li class="navListItem"><a class="navItem" href="/resolve/docs/troubleshooting">Troubleshooting</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Sagas</h1></header><article><div><span><p>A saga describes a long running process as a sequence of events.</p>
<h2><a class="anchor" aria-hidden="true" id="sagas-overview"></a><a href="#sagas-overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sagas Overview</h2>
<p>You can define a saga as a set of event handler functions. Each function runs in response to a specific event and can do the following:</p>
<ul>
<li>Send a command to an aggregate</li>
<li>Schedule a command at the specified moment in time</li>
<li>Store intermediate data in a persistent storage</li>
<li>Trigger a side effect</li>
</ul>
<p>This functionality allows you to organize branched chains of events and side effects to describe processes of any complexity. For example, the code below demonstrates a saga that structures a web site's user registration process:</p>
<!-- prettier-ignore-start -->
<pre><code class="hljs css language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">handlers</span>: {
    <span class="hljs-attr">Init</span>: <span class="hljs-keyword">async</span> ({ store }) =&gt; {
      <span class="hljs-keyword">await</span> store.defineTable(<span class="hljs-string">'users'</span>, {
        <span class="hljs-attr">indexes</span>: { <span class="hljs-attr">id</span>: <span class="hljs-string">'string'</span> },
        <span class="hljs-attr">fields</span>: [<span class="hljs-string">'mail'</span>]
      })
    },
    <span class="hljs-attr">USER_CREATED</span>: <span class="hljs-keyword">async</span> ({ store, sideEffects }, event) =&gt; {
      <span class="hljs-keyword">await</span> store.insert(<span class="hljs-string">'users'</span>, {
        <span class="hljs-attr">id</span>: event.aggregateId,
        <span class="hljs-attr">mail</span>: event.payload.mail
      })
      <span class="hljs-keyword">await</span> sideEffects.executeCommand({
        <span class="hljs-attr">aggregateName</span>: <span class="hljs-string">'User'</span>,
        <span class="hljs-attr">aggregateId</span>: event.aggregateId,
        <span class="hljs-attr">type</span>: <span class="hljs-string">'requestConfirmUser'</span>,
        <span class="hljs-attr">payload</span>: event.payload
      })
    },
    <span class="hljs-attr">USER_CONFIRM_REQUESTED</span>: <span class="hljs-keyword">async</span> ({ sideEffects }, event) =&gt; {
      <span class="hljs-keyword">await</span> sideEffects.sendEmail(event.payload.mail, <span class="hljs-string">'Confirm mail'</span>)
      <span class="hljs-keyword">await</span> sideEffects.scheduleCommand(
        event.timestamp + <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span>,
        {
          <span class="hljs-attr">aggregateName</span>: <span class="hljs-string">'User'</span>,
          <span class="hljs-attr">aggregateId</span>: event.aggregateId,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'forgetUser'</span>,
          <span class="hljs-attr">payload</span>: {}
        }
      )
    },
    <span class="hljs-attr">USER_FORGOTTEN</span>: <span class="hljs-keyword">async</span> ({ store }, event) =&gt; {
      <span class="hljs-keyword">await</span> store.delete(<span class="hljs-string">'users'</span>, {
        <span class="hljs-attr">id</span>: event.aggregateId
      })
    }
  },
  <span class="hljs-attr">sideEffects</span>: {
    <span class="hljs-attr">sendEmail</span>: <span class="hljs-keyword">async</span> (mail, content) =&gt; {
      ...
    }
  }
}
</code></pre>
<!-- prettier-ignore-end -->
<p>The saga requests that a new user confirms his/her email address. If the user does not confirm the address within one week, the saga cancels the registration.</p>
<h2><a class="anchor" aria-hidden="true" id="define-a-saga"></a><a href="#define-a-saga" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Define a Saga</h2>
<h3><a class="anchor" aria-hidden="true" id="add-a-saga-to-the-application"></a><a href="#add-a-saga-to-the-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add a Saga to the Application</h3>
<p>You can define a saga in one of the following ways:</p>
<ul>
<li><p>In one source file as an object that contains the <code>handlers</code> and <code>sideEffects</code> objects.</p>
<h5><a class="anchor" aria-hidden="true" id="commonsagasuser-confirmationsagajs"></a><a href="#commonsagasuser-confirmationsagajs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>common/sagas/user-confirmation.saga.js:</h5>
<pre><code class="hljs css language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">handlers</span>: {
    <span class="hljs-comment">// Event handlers implementation</span>
  }
  <span class="hljs-attr">sideEffects</span>: {
    <span class="hljs-comment">// Side effects implementation</span>
  }
}
</code></pre></li>
<li><p>In two separate files.</p>
<h5><a class="anchor" aria-hidden="true" id="commonsagasuser-confirmationhandlersjs"></a><a href="#commonsagasuser-confirmationhandlersjs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>common/sagas/user-confirmation.handlers.js:</h5>
<pre><code class="hljs css language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// Event handlers implementation</span>
}
</code></pre>
<h5><a class="anchor" aria-hidden="true" id="commonsagasuser-confirmationside-effectsjs"></a><a href="#commonsagasuser-confirmationside-effectsjs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>common/sagas/user-confirmation.side-effects.js:</h5>
<pre><code class="hljs css language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// Side effects implementation</span>
}
</code></pre></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="initialize-the-eventstore"></a><a href="#initialize-the-eventstore" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initialize the EventStore</h3>
<p>Every saga should define an <code>Init</code> function that initializes the saga's persistent storage:</p>
<!-- prettier-ignore-start -->
<pre><code class="hljs css language-js">Init: <span class="hljs-keyword">async</span> ({ store }) =&gt; {
  <span class="hljs-keyword">await</span> store.defineTable(<span class="hljs-string">'users'</span>, {
    <span class="hljs-attr">indexes</span>: { <span class="hljs-attr">id</span>: <span class="hljs-string">'string'</span> },
    <span class="hljs-attr">fields</span>: [<span class="hljs-string">'mail'</span>]
  })
},
</code></pre>
<!-- prettier-ignore-end -->
<h3><a class="anchor" aria-hidden="true" id="handle-events"></a><a href="#handle-events" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Handle Events</h3>
<p>An event handler function runs for each occurrence of a specific event. It has the following general structure:</p>
<pre><code class="hljs css language-js">EVENT_NAME: <span class="hljs-keyword">async</span> ({ store, sideEffects }, event) =&gt; {
  <span class="hljs-comment">// Event handler logic</span>
}
</code></pre>
<p>As a first argument, an event handler receives an object that provides access to the following API:</p>
<ul>
<li><code>store</code> - Provides access to the saga's persistent store (similar to the Read Model store).</li>
<li><code>sideEffects</code> - Provides access to the saga's side effect functions.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="use-side-effects"></a><a href="#use-side-effects" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Use Side Effects</h3>
<p>You should define all functions that have side effects in the <code>sideEffects</code> object.</p>
<!-- prettier-ignore-start -->
<pre><code class="hljs css language-js">sideEffects: {
  <span class="hljs-attr">sendEmail</span>: <span class="hljs-keyword">async</span> (mail, content) =&gt; {
    ...
  }
}
</code></pre>
<!-- prettier-ignore-end -->
<p>You can trigger the defined side effects from an event handler as shown below:</p>
<!-- prettier-ignore-start -->
<pre><code class="hljs css language-js"><span class="hljs-keyword">await</span> sideEffects.sendEmail(event.payload.mail, <span class="hljs-string">'Confirm mail'</span>)
</code></pre>
<!-- prettier-ignore-end -->
<p>The following side effect functions are available by default:</p>
<ul>
<li><code>executeCommand</code> - Sends a command with the specified payload to an aggregate.</li>
<li><code>scheduleCommand</code> - Similar to <code>executeCommand</code>, but delays command execution until a specified moment in time.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="side-effect-starting-timestamp"></a><a href="#side-effect-starting-timestamp" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Side Effect Starting Timestamp</h4>
<p>Each saga stores a <code>RESOLVE_SIDE_EFFECTS_START_TIMESTAMP</code> property. This property's value is a timestamp that defines the latest point in time for which side effects are allowed. If an event is older than this timestamp, all side effect functions for the current event handler are replaced with stub functions that do nothing. This is required to guarantee that side effect logic is never invoked more than once for a given event. Note that if you reset the Saga, the timestamp is preserved and side effects are not re-invoked as the saga rebuilds its state.</p>
<p>The <code>sideEffects</code> object's <code>isEnabled</code> field indicates whether or not side effects are enabled for the processed event.</p>
<p>If your need to re-run side effects after you reset a saga's state, use the <a href="https://www.npmjs.com/package/@resolve-js/module-admin">@resolve-js/module-admin</a> CLI tool to assign the desired timestamp to the <code>RESOLVE_SIDE_EFFECTS_START_TIMESTAMP</code> property:</p>
<pre><code class="hljs css language-bash">npx @resolve-js/module-admin sagas properties <span class="hljs-built_in">set</span> <span class="hljs-string">"UserConfirmation"</span> <span class="hljs-string">"RESOLVE_SIDE_EFFECTS_START_TIMESTAMP"</span> $(date +%s%3N -d <span class="hljs-string">"yesterday"</span>)
</code></pre>
<p>You can also specify a new timestamp as an option for the <code>sagas reset</code> command:</p>
<pre><code class="hljs css language-bash">npx @resolve-js/module-admin sagas reset UserConfirmation --side-effects-start-timestamp 0000-00-0000:00:00.000
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="send-aggregate-commands"></a><a href="#send-aggregate-commands" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Send Aggregate Commands</h3>
<p>Use the <code>executeCommand</code> side effect function to send aggregate commands as shown below:</p>
<!-- prettier-ignore-start -->
<pre><code class="hljs css language-js"><span class="hljs-keyword">await</span> sideEffects.executeCommand({
  <span class="hljs-attr">aggregateName</span>: <span class="hljs-string">'User'</span>,
  <span class="hljs-attr">aggregateId</span>: event.aggregateId,
  <span class="hljs-attr">type</span>: <span class="hljs-string">'requestConfirmUser'</span>,
  <span class="hljs-attr">payload</span>: event.payload
})
</code></pre>
<!-- prettier-ignore-end -->
<h3><a class="anchor" aria-hidden="true" id="schedule-aggregate-commands"></a><a href="#schedule-aggregate-commands" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schedule Aggregate Commands</h3>
<p>The code sample below demonstrates how the command executes at a specified point in time.</p>
<!-- prettier-ignore-start -->
<pre><code class="hljs css language-js"><span class="hljs-keyword">await</span> sideEffects.scheduleCommand(
  event.timestamp + <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span>,
  {
    <span class="hljs-attr">aggregateName</span>: <span class="hljs-string">'User'</span>,
    <span class="hljs-attr">aggregateId</span>: event.aggregateId,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'forgetUser'</span>,
    <span class="hljs-attr">payload</span>: {}
  }
)
</code></pre>
<!-- prettier-ignore-end -->
<h2><a class="anchor" aria-hidden="true" id="register-a-saga"></a><a href="#register-a-saga" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Register a Saga</h2>
<p>To use a saga in your application, you need to register it in the application's configuration file. If a saga is defined in a single file, you can register it as shown below:</p>
<pre><code class="hljs css language-js">sagas: [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'UserConfirmation'</span>,
    <span class="hljs-attr">source</span>: <span class="hljs-string">'common/sagas/user-confirmation.saga.js'</span>,
    <span class="hljs-attr">connectorName</span>: <span class="hljs-string">'default'</span>,
  },
]
</code></pre>
<p>If a saga is split between two files, register it as follows:</p>
<pre><code class="hljs css language-js">sagas: [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'UserConfirmation'</span>,
    <span class="hljs-attr">source</span>: <span class="hljs-string">'common/sagas/user-confirmation.handlers.js'</span>,
    <span class="hljs-attr">sideEffects</span>: <span class="hljs-string">'common/sagas/user-confirmation.side-effects.js'</span>,
    <span class="hljs-attr">connectorName</span>: <span class="hljs-string">'default'</span>,
  },
]
</code></pre>
<p>The <code>connectorName</code> option defines a Read Model storage used to store the saga's persistent data.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/resolve/docs/read-side"><span class="arrow-prev">← </span><span>Read Side</span></a><a class="docs-next button" href="/resolve/docs/api-handlers"><span>API Handlers</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#sagas-overview">Sagas Overview</a></li><li><a href="#define-a-saga">Define a Saga</a><ul class="toc-headings"><li><a href="#add-a-saga-to-the-application">Add a Saga to the Application</a></li><li><a href="#initialize-the-eventstore">Initialize the EventStore</a></li><li><a href="#handle-events">Handle Events</a></li><li><a href="#use-side-effects">Use Side Effects</a></li><li><a href="#send-aggregate-commands">Send Aggregate Commands</a></li><li><a href="#schedule-aggregate-commands">Schedule Aggregate Commands</a></li></ul></li><li><a href="#register-a-saga">Register a Saga</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/resolve/" class="nav-home"><img src="/resolve/img/resolve.svg" alt="reSolve" width="66" height="58"/></a><div><h5>Docs</h5><a href="/resolve/docs/">Documentation Index</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/resolvejs" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/resolvejs" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.facebook.com/resolvejs/" target="_blank" rel="noreferrer noopener">Facebook</a></div><div><h5>More</h5><a href="https://github.com/reimagined/resolve">GitHub</a><a class="github-button" href="https://github.com/reimagined/resolve" data-icon="octicon-star" data-count-href="/reimagined/resolve/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2021 Developer Express, Inc</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '2acd75b7a94d568aa418a4f02bd811cc',
                indexName: 'reimagined_resolve',
                inputSelector: '#search_input_react'
              });
            </script></body></html>